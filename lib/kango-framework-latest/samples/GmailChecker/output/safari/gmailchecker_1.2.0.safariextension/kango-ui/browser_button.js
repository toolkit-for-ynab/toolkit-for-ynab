"use strict";
_kangoLoader.add("kango-ui/browser_button", function(require, exports, module) {
function BrowserButtonBase(t){EventTarget.call(this),this._details=t}function getPublicApi(){return utils.createApiWrapper(module.exports,BrowserButtonBase.prototype,IEventTarget.prototype)}var utils=require("kango/utils"),object=utils.object,EventTarget=utils.EventTarget,IEventTarget=utils.IEventTarget,NotImplementedException=utils.NotImplementedException;BrowserButtonBase.prototype=object.extend(EventTarget,{_details:null,event:{COMMAND:"command",POPUP_DOCUMENT_COMPLETE:"PopupDocumentComplete"},setTooltipText:function(t){throw new NotImplementedException},setCaption:function(t){throw new NotImplementedException},setIcon:function(t){throw new NotImplementedException},setBadgeValue:function(t){throw new NotImplementedException},setBadgeBackgroundColor:function(t){throw new NotImplementedException},setPopup:function(t){throw new NotImplementedException},setContextMenu:function(){throw new NotImplementedException}});







function BrowserButton(t){BrowserButtonBase.call(this,t),this._icon=t.icon||null,this._tooltipText=t.tooltipText||"",this._popupDetails=t.popup||null,this._badgeValue=0,this._popover=null,safari.application.addEventListener("command",func.bind(function(t){t.command==this._commandName&&this.fireEvent(this.event.COMMAND)},this),!0),safari.application.addEventListener("popover",func.bind(function(t){var o=t.target;o.identifier==this._popoverId&&(o.width=this._popupDetails.width,o.height=this._popupDetails.height,o.contentWindow.location.reload())},this),!0);var o=this._getButton();null!=o&&this._initButton(o),safari.application.addEventListener("validate",func.bind(function(t){if(t.target instanceof SafariExtensionToolbarItem)for(var o=safari.extension.toolbarItems,e=0;e<o.length;e++)this._initButton(o[e])},this),!0)}var extensionInfo=require("kango/extension_info"),utils=require("kango/utils"),object=utils.object,func=utils.func,io=require("kango/io");BrowserButton.prototype=object.extend(BrowserButtonBase,{_id:"kango-ui-button",_popoverId:"kango-ui-popup",_commandName:"KangoButtonCommand",_getButton:function(){for(var t=safari.extension.toolbarItems,o=0;o<t.length;o++)if(t[o].identifier==this._id)return t[o];return null},_initButton:function(t){null!=this._icon&&this._setIcon(t,this._icon),""!=this._tooltipText&&this._setTooltipText(t,this._tooltipText),0!=this._badgeValue&&this._setBadgeValue(t,this._badgeValue),null!=this._popupDetails?null==this._popover?this._setPopup(t,this._popupDetails):(t.popover=this._popover,t.command=null):(t.command=this._commandName,t.popover=null)},_removePopup:function(t){t.popover=this._popover=null,safari.extension.removePopover(this._popoverId),t.command=this._commandName},_setPopup:function(t,o){if(null!=o&&object.isString(o.url)){var e="",i=o.height,n=o.width;null!=o&&object.isString(o.url)&&(e=o.url),this._removePopup(t),t.popover=this._popover=safari.extension.createPopover(this._popoverId,safari.extension.baseURI+e,n,i),t.command=null,t.popover.width=o.width,t.popover.height=i}else this._removePopup(t)},_setTooltipText:function(t,o){t.toolTip=o.replace(/\n/g,"; ").replace(/\r/g,"")},_setIcon:function(t,o){t.image=safari.extension.baseURI+o},_setBadgeValue:function(t,o){t.badge=parseInt(o,10)},setTooltipText:function(t){this._tooltipText=t;var o=this._getButton();null!=o&&this._setTooltipText(o,t)},setCaption:function(t){},setIcon:function(t){this._icon=t;var o=this._getButton();null!=o&&this._setIcon(o,t)},setBadgeValue:function(t){this._badgeValue=t;var o=this._getButton();null!=o&&null!=t&&this._setBadgeValue(o,t)},setBadgeBackgroundColor:function(t){},setPopup:function(t){this._popupDetails=t;var o=this._getButton();if(null!=o)if(o.popover&&o.popover.visible){var e=this;timer.setTimeout(function(){e.setPopup(e._popupDetails)},100)}else this._setPopup(o,t)},closePopup:function(){var t=this._getButton();null!=t&&null!=t.popover&&t.popover.hide()},getPopupDetails:function(){return this._popupDetails},setContextMenu:function(){}}),extensionInfo.browser_button&&(module.exports=new BrowserButton(extensionInfo.browser_button),module.exports.getPublicApi=getPublicApi);
});