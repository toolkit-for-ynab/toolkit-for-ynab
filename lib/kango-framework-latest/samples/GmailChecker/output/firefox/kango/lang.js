function LangBase(){}var NotImplementedException=require("kango/utils").NotImplementedException;LangBase.prototype={evalInSandbox:function(e,n){throw new NotImplementedException},evalScriptsInSandbox:function(e,n){for(var t="",o=0;o<n.length;o++){for(var r=0;r<n[o].requires.length;r++)t+=n[o].requires[r].text+"\n\n";t+=n[o].text+"\n\n"}return this.evalInSandbox(e,t)}};







function HTMLSandbox(){this._browserId="kango-background-script-host_"+utils.utils.getDomainFromId(extensionInfo.id),this._frameEventListener=null}function Lang(){}var extensionInfo=require("kango/extension_info"),utils=require("kango/utils"),object=utils.object,array=utils.array,browser=require("kango/browser"),chromeWindows=require("kango/chrome_windows"),io=require("kango/io"),console=require("kango/console");HTMLSandbox.prototype={create:function(e,t,o){var r=chromeWindows.getHiddenWindow(),n=r.document.createElementNS("http://www.w3.org/1999/xhtml","iframe");n.setAttribute("type","chrome"),n.setAttribute("id",this._browserId),this._frameEventListener=function(e){var r=e.target.defaultView.wrappedJSObject;r.onunload=function(){o(r)},t(r)},n.addEventListener("DOMContentLoaded",this._frameEventListener,!1),n.setAttribute("src",io.getExtensionFileUrl(e)),r.document.documentElement.appendChild(n)},dispose:function(){var e=chromeWindows.getHiddenWindow(),t=e.document.getElementById(this._browserId);t.removeEventListener("DOMContentLoaded",this._frameEventListener,!1),t.parentNode.removeChild(t)}},Lang.prototype=object.extend(LangBase,{_executeScript:function(e,t){try{null!=e.path?Services.scriptloader.loadSubScript(e.path,t,"UTF-8"):Cu.evalInSandbox(e.text,t,"default",e.path,1)}catch(o){console.reportError(o,e.path)}},exposeObject:function(e,t,o){if(Services.vc.compare(Services.appinfo.platformVersion,"34")>=0)return Cu.cloneInto(e,o,{cloneFunctions:!0});t=t||"r",e.__exposedProps__=e.__exposedProps__||{};for(var r in e)"__exposedProps__"!=r&&e.hasOwnProperty(r)&&(e.__exposedProps__[r]=t,e[r]&&object.isObject(e[r])&&this.exposeObject(e[r],t,o));return e},createHTMLSandbox:function(e,t,o){var r=new HTMLSandbox;return r.create(e,t,o),r},evalScriptsInSandbox:function(e,t,o){var r=browser.getSandboxForWindow(e,o);array.forEach(t,function(e){array.forEach(e.requires,function(e){this._executeScript(e,r)},this),this._executeScript(e,r)},this)}}),module.exports=new Lang;